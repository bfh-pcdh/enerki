# Hardware used for enerki
This document describes the hardware used in the enerki project. It provides you with the information to reproduce the setup yourself.

## What is needed
- [some kind of stationary bicycle](#bicycle)
- [a computing device](#computing-device)
- [a sensor for measuring power](#power-sensor)
- [a ANT+ dongle](#ant-dongle)
- [an endpoint for LLM](#llm-endpoint)

### Bicycle
We used a spinning bike from Schwinn that we already had available. But you can use any stationary bicycle, as long as you can screw standard bicycle pedals onto the crank.  
In theory, you can also use a smart trainer, as long as it is able to broadcast an ANT+ signal. However, we did not test that, and it may require some adjustments to the code.

### Computing device
Of course we need a device where the user interface runs. The requirements are basic: It needs to be able to run Google Chrome, and it needs an USB port and an internet connection. When using the setup on an event, it can also be useful to connect a big screen via HDMI, but this is not a must. Also, the device does not need much processing power, as it only displays a webapp and the inference is run in the cloud by default.
For correctly running the webapp, the browser used needs to support WebUSB. We chose [Google Chrome](https://www.google.com/chrome/) for availability, but the [compability chart](https://developer.mozilla.org/en-US/docs/Web/API/WebUSB_API) lists other browsers that do. As the time of writing this document, Firefox and Safari are not compatible, so you can not use them.  
In our setup, we used an older MacBook Pro, with Google Chrome.  
We were also able to run enerki on an Android Tablet (a Samsung Galaxy Tab S5e), where connecting the ANT+ dongle worked flawlessly. However, the WebApp is not optimized for this screen size with an onscreen keyboard taking up much of the screenspace. 

### Power sensor
We were using [Assioma Pro RS](https://cycling.favero.com/assioma-pro-rs/) powermeter pedals to measure the power generated by the user. For our usecase, it is not necessary to buy the expensive dual-sided pedals, the cheaper one-sided pedals work fine. Since the pedals are made for clipping in with cycling shoes, they are not very comfortable when using normal shoes. We solved this with 3D-printing an adaptor plate, using this [model](https://www.thingiverse.com/thing:3669328). We needed to cut off a small part after printing, but then these plates fit on the Assioma pedals.

You can use other powermeter hardware (e.g. powermeter cranks), as long it supports ANT+. However, we found the aforementioned pedals to be the option that is the most economical and easiest to combine with the spinning bike.  

### ANT+ dongle
For receiving the power sensors signal, we need an ANT+ dongle. We were using a [ANT+ USB Adapte from Garmin](https://www.digitec.ch/de/s1/product/garmin-usb-ant-stick-gps-geraet-2774620). For connecting with the MacBook Pro or the Android Tablet, we used a common USB A to USB C adapter, but the necessety may vary with your setup.

### LLM endpoint
enerki needs a chatbot API in order to work. Per default, we are using our [own internal inference service](https://inference.mlmp.ti.bfh.ch/). This is however only accessible in the network of the Bern University of Applied Sciences, so if you want to use another service, you need to adjust the [env file](./env.ts) accordingly.


## Set up
The following chapter describes how we prepared our set up. If you use other components, things might be a bit different.
### Bicycle
1. Remove the old pedals from the bicycle. This may need a bit of strength. Also mind that bicycle pedals have a different threaded mount on the left side. If you encounter problems, ask your local bike nerd or [YouTube](https://www.youtube.com/shorts/UbGWbPbRW9M).
2. Charge the power meter pedals with the cable that came in the box and install them on the bicycle. 
3. Before you can use the power meter pedals, you need to register them with the [Assioma App](https://cycling.favero.com/faq/#sezione-5). In the app, you can also download firmware updates to your pedals, or set the time after which the pedals go to sleep. Our experience was, that a higher sleep time (e.g. 30 minutes) is useful during events.
### Laptop
1. On Windows, you may have to [install a driver for the Garmin ANT+ dongle](https://support.garmin.com/de-CH/?faq=lhcXYdqFRP1bbumefCOf37). On MacOS and Android, we experienced the dongle to work out of the box. We needed an USB A to USB C adapter though. After plugging the dongle into the computer, it connects automatically to the power meter pedals (make sure they are not in sleep mode). When also connecting a HDMI cable, our setup worked best if we used separate adapters for the dongle and the HDMI cable. With the combined USB-A and HDMI adapter, the ANT+ connection was sometimes unstable.
2. If you want to run the WebApp locally, you need to have [node.js](https://nodejs.org/en/download) installed. The WebApp is written in Vue.js, so if you're not yet familiar with that, you can consult the [Vue.js documentation](https://vuejs.org/guide/introduction.html).
3. Run `npm install` in the root directory of the repository to install the dependencies.
4. Set up the [env file](./env.ts) to match the LLM endpoint you're using. You can enter the access token to the env file (but make sure not to commit it to Github), or enter it in the Webapp during runtime.
5. With `npm run dev`, you can run the WebApp on your local computer. When running, point your browser to [localhost:4200](http://localhost:4200). With `npm run build`, you can build the WebApp to deploy it on a web server.

2026-01-23 heg2@bfh.ch